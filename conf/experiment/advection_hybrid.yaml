# @package _global_

# Hybrid Training: Synthetic Model Only Sees Real Data
# Use case: You trust your data and want the synthetic model to learn from it,
#           while the physical model adapts based on the synthetic predictions

defaults:
  - override /data: advection_128
  - override /model/physical: advection
  - override /model/synthetic: unet
  - override /trainer: hybrid
  - override /generation: default
  - override /evaluation: default
  - _self_

run_params:
  experiment_name: 'advection_experiment'
  notes: 'Hybrid training with synthetic model learning from real data only'
  mode: ['train', 'evaluate']  # Options: generate, train, evaluate
  model_type: 'hybrid'  # Options: synthetic, physical, hybrid

model:
  synthetic:
    model_save_name: 'hybrid_advection_unet_128'

generation_params:
  num_simulations: 1
  total_steps: 100
  save_interval: 1

trainer_params:
  # Training data
  train_sim: [1]  # Training simulations
  val_sim: [0]  # Validation simulations
  percentage_real_data: 0.5  # Use all real data for synthetic model
  
  # Training hyperparameters
  epochs: 10
  batch_size: 16
  num_predict_steps: 4
  
  # Optimizer (for synthetic/hybrid)
  learning_rate: 0.0001
  optimizer: 'adam'
  scheduler: 'cosine'
  weight_decay: 0.0
  
  # Physical model learnable parameters (for physical/hybrid)
  learnable_parameters:
    - name: 'advection_coeff'
      initial_guess: 0.3  # Starting value for optimization
  
  # Validation
  validate_every: 10
  validation_rollout_steps: 75
  
  # Checkpointing
  print_freq: 10

  # Physical model optimization settings
  method: 'L-BFGS-B'  # Gradient descent
  abs_tol: 1e-3
  max_iterations: 5 # Maximum optimization iterations



  # Hybrid config
  hybrid:
    num_cycles: 1000
    synthetic_epochs_per_cycle: 1 # More synthetic training
    physical_epochs_per_cycle: 1   # Physical learns from synthetic
    warmup_synthetic_epochs: 1  # Establish synthetic baseline
    
    # KEY PARAMETER: Only synthetic model sees real data
    real_data_access: 'both'  # Options: 'both', 'synthetic_only', 'physical_only', 'none'

  augmentation:
    alpha: 1.0  # More physics-based augmentation

evaluation_params:
  test_sim: [0, 1]
  num_frames: 75
  metrics: ['mse', 'mae', 'rmse']
  save_animations: true
  save_plots: true

project_root: ${hydra:runtime.cwd}

# Expected behavior:
# - Cycle 1:
#   1. Synthetic trains on REAL data + physics predictions
#   2. Physical trains on SYNTHETIC predictions only (no real data)
# - Cycle 2-15:
#   1. Synthetic trains on REAL data + improved physics predictions
#   2. Physical trains on SYNTHETIC predictions (parameters adapt to learned dynamics)
#
# Use this when:
#   - You have high-quality observational data
#   - You want synthetic model to be data-driven
#   - You want physics parameters to adapt to learned dynamics
#   - You're testing if physics model can "reverse engineer" from synthetic predictions
